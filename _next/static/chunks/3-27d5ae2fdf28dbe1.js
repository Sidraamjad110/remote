"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{3:function(e,r,t){t.r(r),t.d(r,{default:function(){return Categories}});var a=t(5893),s=t(7294),o=t(6445),n=t(5848),l=t(9204),d=t(5349),i=t(4601),c=t(2743),g=t(6501),u=t(4230);function Categories(e){let{token:r,isAuthenticated:t,logout:h,categories:y,setCategories:x,onFormActive:m}=e,[p,b]=(0,s.useState)(1),[f,v]=(0,s.useState)(!0),[j,w]=(0,s.useState)(null),[N,k]=(0,s.useState)(null),[E,C]=(0,s.useState)(null),[A,P]=(0,s.useState)(""),[S,_]=(0,s.useState)(""),[Z,D]=(0,s.useState)(null),[F,I]=(0,s.useState)(""),[R,T]=(0,s.useState)(""),[z,U]=(0,s.useState)(!1),[L,q]=(0,s.useState)(null),[B,M]=(0,s.useState)("");(0,s.useEffect)(()=>{if(!t||!r){v(!1);return}let fetchData=async()=>{try{k(null);let e=await (0,u.pE)(r,h);x(e)}catch(r){let e=r instanceof Error?r.message:"Failed to fetch categories";k(e),g.ZP.error(e)}finally{v(!1)}};fetchData()},[t,r,h,x]),(0,s.useEffect)(()=>{m(!!E)},[E,m]),(0,s.useEffect)(()=>{let e=Math.ceil(y.length/9);p>e&&e>0?b(e):0===y.length&&b(1)},[y,p]);let handleAddCategory=async e=>{if(e.preventDefault(),!t||!r){g.ZP.error("Please log in to add a category");return}if(!A.trim()||!S.trim()){g.ZP.error("Name and description are required");return}try{w(null);let e=await (0,u.i8)(r,h,A,S);x([...y,e]),resetForm(),g.ZP.success("Category added successfully")}catch(r){let e=r instanceof Error?r.message:"Failed to add category";w(e),g.ZP.error(e)}},handleEditCategory=e=>{D(e._id),I(e.name),T(e.description),C("edit")},handleSaveEditCategory=async e=>{if(e.preventDefault(),!t||!r||!Z){g.ZP.error("Please log in to update a category");return}if(!F.trim()||!R.trim()){g.ZP.error("Name and description are required");return}try{w(null);let e=await (0,u.yr)(r,h,Z,F,R);x(y.map(r=>r._id===Z?e:r)),resetForm(),g.ZP.success("Category updated successfully")}catch(r){let e=r instanceof Error?r.message:"Failed to update category";w(e),g.ZP.error(e)}},handleDeleteCategory=(e,r)=>{q(e),M(r),U(!0)},confirmDelete=async()=>{if(!t||!r||!L){g.ZP.error("Please log in to delete");return}try{k(null),await (0,u.uu)(r,h,L),x(y.filter(e=>e._id!==L)),g.ZP.success("Category deleted successfully")}catch(r){let e=r instanceof Error?r.message:"Failed to delete category";k(e),g.ZP.error(e)}finally{U(!1),q(null),M("")}},resetForm=()=>{C(null),P(""),_(""),D(null),I(""),T(""),w(null),k(null)},O=9*p,J=O-9,H=Array.isArray(y)?y.slice(J,O):[],Y=Array.isArray(y)?Math.ceil(y.length/9):1;return f?(0,a.jsx)("div",{className:"lg:col-span-1 bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 border border-gray-200 dark:border-gray-700 h-full",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded-lg"}),[,,,,].fill(0).map((e,r)=>(0,a.jsx)("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded-lg"},r))]})}):(0,a.jsxs)("div",{className:"lg:col-span-1 bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 border border-gray-200 dark:border-gray-700 h-full relative",children:[(0,a.jsxs)("div",{className:"absolute inset-0 z-10 bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-y-auto",style:{display:E?"block":"none"},children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"add"===E?"Add New Category":"Edit Category"}),(0,a.jsx)("button",{onClick:resetForm,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,a.jsx)(o.Z,{className:"w-6 h-6"})})]}),(0,a.jsxs)("form",{onSubmit:"add"===E?handleAddCategory:handleSaveEditCategory,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Category Name"}),(0,a.jsx)("input",{type:"text",value:"edit"===E?F:A,onChange:e=>"edit"===E?I(e.target.value):P(e.target.value),placeholder:"Enter category name",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-800 dark:text-gray-200 bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),(0,a.jsx)("textarea",{value:"edit"===E?R:S,onChange:e=>"edit"===E?T(e.target.value):_(e.target.value),placeholder:"Enter category description",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-800 dark:text-gray-200 bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",rows:3,required:!0})]}),j&&(0,a.jsx)("div",{className:"text-red-500 dark:text-red-400 text-sm text-center",children:j}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:resetForm,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center",children:"edit"===E?"Save Changes":"Add Category"})]})]})]}),(0,a.jsxs)("div",{className:"relative z-0",style:{opacity:E?.5:1,pointerEvents:E?"none":"auto"},children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center",children:[(0,a.jsx)("span",{className:"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-300 p-2 rounded-lg mr-2",children:"Categories"}),(0,a.jsxs)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[y.length," total"]})]}),(0,a.jsxs)("button",{onClick:()=>C("add"),className:"flex items-center px-3 py-1 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[(0,a.jsx)(n.Z,{className:"w-4 h-4 mr-1"}),(0,a.jsx)("span",{className:"text-sm",children:"Add"})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 uppercase text-xs",children:[(0,a.jsx)("th",{className:"py-3 px-4",children:"Name"}),(0,a.jsx)("th",{className:"py-3 px-4",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:H.map((e,r)=>(0,a.jsxs)("tr",{className:"border-b border-gray-200 dark:border-gray-700 ".concat(r%2==0?"bg-gray-50 dark:bg-gray-700/50":"bg-white dark:bg-gray-800"," hover:bg-gray-100 dark:hover:bg-gray-600"),children:[(0,a.jsx)("td",{className:"py-3 px-4 text-gray-800 dark:text-gray-200 font-semibold",children:e.name}),(0,a.jsxs)("td",{className:"py-3 px-4 flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>handleEditCategory(e),className:"text-blue-600 hover:text-blue-800 p-1 rounded-full hover:bg-blue-100 dark:hover:bg-blue-900/50",title:"Edit",children:(0,a.jsx)(l.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>handleDeleteCategory(e._id,e.name),className:"text-red-600 hover:text-red-800 p-1 rounded-full hover:bg-red-100 dark:hover:bg-red-900/50",title:"Delete",children:(0,a.jsx)(d.Z,{className:"w-4 h-4"})})]})]},e._id))})]})}),N&&(0,a.jsx)("div",{className:"mt-4 text-red-500 dark:text-red-400 text-center text-sm",children:N}),Y>1&&(0,a.jsxs)("div",{className:"flex justify-between items-center mt-4 px-2",children:[(0,a.jsxs)("button",{onClick:()=>b(Math.max(p-1,1)),disabled:1===p,className:"flex items-center px-3 py-1 rounded-lg ".concat(1===p?"text-gray-400 cursor-not-allowed":"text-indigo-600 hover:bg-indigo-50 dark:hover:bg-gray-700"),children:[(0,a.jsx)(i.Z,{className:"w-4 h-4 mr-1"}),"Prev"]}),(0,a.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Page ",p," of ",Y]}),(0,a.jsxs)("button",{onClick:()=>b(Math.min(p+1,Y)),disabled:p===Y,className:"flex items-center px-3 py-1 rounded-lg ".concat(p===Y?"text-gray-400 cursor-not-allowed":"text-indigo-600 hover:bg-indigo-50 dark:hover:bg-gray-700"),children:["Next",(0,a.jsx)(c.Z,{className:"w-4 h-4 ml-1"})]})]})]}),z&&L&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center border-b border-gray-200 dark:border-gray-700 p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Confirm Deletion"}),(0,a.jsx)("button",{onClick:()=>{U(!1),q(null),M(""),k(null)},className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:(0,a.jsx)(o.Z,{className:"w-6 h-6"})})]}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:['Are you sure you want to delete the category "',B,'"? Products in this category will not be deleted.']}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:()=>{U(!1),q(null),M(""),k(null)},className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),(0,a.jsx)("button",{onClick:confirmDelete,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center",children:"Yes, Delete"})]})]})]})})]})}},4230:function(e,r,t){t.d(r,{i8:function(){return addCategory},pE:function(){return fetchCategories},uu:function(){return deleteCategory},yr:function(){return updateCategory}});var a=t(3454);let handleApiError=(e,r)=>{if(!e.success)switch(console.error("API Error:",e),e.statusCode){case 400:return e.message||"Invalid input provided";case 401:return r(),"Please log in to continue";case 403:return"Access denied";case 404:return e.message||"Resource not found";case 409:return e.message||"Duplicate entry";case 500:return"An unexpected server error occurred";default:return"An unexpected error occurred"}return""},fetchCategories=async(e,r)=>{try{let t=a.env.REACT_APP_API_URL||"http://192.168.18.107:3000";console.log("API URL:",t),console.log("Fetching categories from:","".concat(t,"/categories/api/v1/list")),console.log("Using token:",e);let s=await fetch("".concat(t,"/categories/api/v1/list"),{headers:{Authorization:"Bearer ".concat(e)}});if(console.log("Response status:",s.status),console.log("Response headers:",s.headers.get("content-type")),!s.ok){let e="HTTP error! status: ".concat(s.status);try{let t=s.headers.get("content-type");if(null==t?void 0:t.includes("application/json")){let t=await s.json();e=handleApiError(t,r)}else{let r=await s.text();e+=", body: ".concat(r.substring(0,100))}}catch(e){console.error("Error parsing response:",e)}throw Error(e)}let o=s.headers.get("content-type");if(!o||!o.includes("application/json"))throw Error("Invalid content type: ".concat(o));let n=await s.json();if(!n.success){let e=handleApiError(n,r);throw Error(e)}if(n.success&&1===n.type&&n.data&&"data"in n.data)return n.data.data||[];throw Error("Invalid response format")}catch(e){throw console.error("Error in fetchCategories:",e),Error(e instanceof Error?e.message:"Failed to fetch categories")}},addCategory=async(e,r,t,s)=>{try{let o=a.env.REACT_APP_API_URL||"http://192.168.18.107:3000",n=await fetch("".concat(o,"/categories/api/v1/create"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({name:t,description:s})}),l=await n.json();if(!l.success){let e=handleApiError(l,r);throw Error(e)}if(l.success&&1===l.type&&l.data)return"data"in l.data?l.data.data:l.data;throw Error("Invalid response format")}catch(e){throw Error(e instanceof Error?e.message:"Failed to add category")}},updateCategory=async(e,r,t,s,o)=>{try{let n=a.env.REACT_APP_API_URL||"http://192.168.18.107:3000",l=await fetch("".concat(n,"/categories/api/v1/update"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({id:t,name:s,description:o})}),d=await l.json();if(!d.success){let e=handleApiError(d,r);throw Error(e)}if(d.success&&1===d.type&&d.data)return"data"in d.data?d.data.data:d.data;throw Error("Invalid response format")}catch(e){throw Error(e instanceof Error?e.message:"Failed to update category")}},deleteCategory=async(e,r,t)=>{try{let s=a.env.REACT_APP_API_URL||"http://192.168.18.107:3000",o=await fetch("".concat(s,"/categories/api/v1/delete"),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({id:t})}),n=await o.json();if(!n.success){let e=handleApiError(n,r);throw Error(e)}if(!n.success||1!==n.type)throw Error("Invalid response format")}catch(e){throw Error(e instanceof Error?e.message:"Failed to delete category")}}}}]);