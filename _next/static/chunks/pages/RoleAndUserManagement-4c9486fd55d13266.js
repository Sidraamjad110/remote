(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[518],{9842:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/RoleAndUserManagement",function(){return r(2052)}])},2052:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return RoleAndUserManagement}});var s=r(5893),a=r(7294),o=r(9332),n=r(1503),l=r(9502),i=r(9053),d=r(1322);function RoleAndUserManagement(){let{isAuthenticated:e,token:t,logout:r}=(0,n.aC)(),c=(0,o.useRouter)(),[g,u]=(0,a.useState)("Users"),[x,h]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{h(!0)},[]),(0,a.useEffect)(()=>{x&&!e&&c.push("/login")},[x,e,c]),x&&e)?(0,s.jsxs)("main",{className:"flex-1 overflow-y-auto p-3 md:p-4 lg:p-5 bg-gray-100 dark:bg-gray-900",children:[(0,s.jsxs)("div",{className:"flex border-b border-gray-200 dark:border-gray-700 mb-4",children:[(0,s.jsx)("button",{className:"px-4 py-2 text-sm font-medium ".concat("Users"===g?"border-b-2 border-indigo-500 text-indigo-600 dark:text-indigo-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),onClick:()=>u("Users"),children:"Users"}),(0,s.jsx)("button",{className:"px-4 py-2 text-sm font-medium ".concat("Roles"===g?"border-b-2 border-indigo-500 text-indigo-600 dark:text-indigo-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),onClick:()=>u("Roles"),children:"Roles"}),(0,s.jsx)("button",{className:"px-4 py-2 text-sm font-medium ".concat("Permissions"===g?"border-b-2 border-indigo-500 text-indigo-600 dark:text-indigo-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),onClick:()=>u("Permissions"),children:"Permissions"})]}),"Users"===g&&(0,s.jsx)(l.default,{token:t,logout:r}),"Roles"===g&&(0,s.jsx)(i.default,{token:t,logout:r}),"Permissions"===g&&(0,s.jsx)(d.default,{token:t,logout:r})]}):null}},9053:function(e,t,r){"use strict";r.r(t);var s=r(5893),a=r(7294),o=r(6249),n=r(50),l=r(6947);t.default=e=>{let{token:t,logout:r}=e,[i,d]=(0,a.useState)([]),[c,g]=(0,a.useState)(""),[u,x]=(0,a.useState)(null),[h,m]=(0,a.useState)(!1),[f,y]=(0,a.useState)(!1),[b,p]=(0,a.useState)(!1),[N,k]=(0,a.useState)(null);(0,a.useEffect)(()=>{t&&fetchRoles()},[t]),(0,a.useEffect)(()=>{if(u){let e=setTimeout(()=>x(null),5e3);return()=>clearTimeout(e)}},[u]);let handleApiError=e=>{if(!e.success)switch(console.error("API Error:",e),e.error){case"DATA_NOT_FOUND":return"Not Found";case"BAD_REQUEST":return e.message||"Invalid input provided";case"ALREADY_EXISTS":return e.message||"Role already exists";case"CONFLICT":return e.message||"Please try again";case"FORBIDDEN":return"Access Denied";case"UNAUTHORIZED":return r(),"Please log in to continue";case"MONGO_EXCEPTION":return console.error("MongoDB Error Details:",e.details),"An error occurred";case"DB_CHECK_FAIL":return e.message||"Database error occurred";default:return"An unexpected error occurred"}return null},fetchRoles=async()=>{try{let e=await fetch("http://192.168.18.107:3000/rolepermission/api/v1/roles/list",{headers:{Authorization:"Bearer ".concat(t)}}),s=await e.json();if(401===e.status){console.log("Unauthorized - logging out"),r();return}if(!e.ok||!s.success){let e=handleApiError(s);throw Error(e||"Failed to fetch roles")}if(s.success&&1===s.type&&s.data)d(s.data.data||[]);else throw Error("Invalid response format")}catch(t){let e=t instanceof Error?t.message:"Unknown error";showMessage(e,!1),console.error("Error fetching roles:",t)}},handleCreateRole=async e=>{if(e.preventDefault(),!c.trim()){showMessage("Role name cannot be empty!",!1);return}y(!0);try{let e=await fetch("http://192.168.18.107:3000/rolepermission/api/v1/roles/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({name:c.trim()})}),s=await e.json();if(401===e.status){console.log("Unauthorized - logging out"),r();return}if(!e.ok||!s.success){let e=handleApiError(s);throw Error(e||"Failed to create role")}s.success&&1===s.type&&s.data&&(d([...i,s.data]),g(""),showMessage("Role created successfully!",!0))}catch(t){let e=t instanceof Error?t.message:"Unknown error";showMessage(e,!1),console.error("Error creating role:",t)}finally{y(!1)}},handleDeleteRole=async e=>{y(!0);try{let s=await fetch("http://192.168.18.107:3000/rolepermission/api/v1/roles/delete",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({role_id:e})}),a=await s.json();if(401===s.status){console.log("Unauthorized - logging out"),r();return}if(!s.ok||!a.success){let e=handleApiError(a);throw Error(e||"Failed to delete role")}a.success&&1===a.type&&(d(i.filter(t=>t._id!==e)),showMessage("Role deleted successfully!",!0))}catch(t){let e=t instanceof Error?t.message:"Unknown error";showMessage(e,!1),console.error("Error deleting role:",t)}finally{y(!1),p(!1)}},openDeleteModal=e=>{k(e),p(!0)},showMessage=(e,t)=>{x(e),m(t)};return(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-3 border border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("h2",{className:"text-base font-semibold text-gray-900 dark:text-white mb-2",children:"Manage Roles"}),(0,s.jsx)("form",{onSubmit:handleCreateRole,className:"space-y-3",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:space-x-3",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"block text-xs text-gray-700 dark:text-gray-300 mb-1",children:"Role Name"}),(0,s.jsx)("input",{type:"text",value:c,onChange:e=>g(e.target.value),className:"w-full p-2 text-xs rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Enter role name"})]}),(0,s.jsx)("div",{className:"mt-4 sm:mt-0 sm:self-end",children:(0,s.jsx)("button",{type:"submit",className:"bg-indigo-500 text-white px-4 py-2 rounded-lg text-xs hover:bg-indigo-600 transition-colors disabled:bg-indigo-300",disabled:f,children:f?"Creating...":"Create Role"})})]})}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-2",children:"Existing Roles"}),0===i.length?(0,s.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"No roles found"}):(0,s.jsx)("ul",{className:"space-y-2",children:i.map(e=>(0,s.jsxs)("li",{className:"flex justify-between items-center p-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-800 dark:text-gray-200 text-xs",children:[(0,s.jsx)("span",{children:e.name}),(0,s.jsx)("button",{onClick:()=>openDeleteModal(e._id),className:"text-red-500 hover:text-red-700 text-xs disabled:opacity-50",disabled:f,children:(0,s.jsx)(o.Z,{className:"w-4 h-4"})})]},e._id))})]}),b&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg w-80",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-2",children:"Confirm Deletion"}),(0,s.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-300 mb-4",children:"Are you sure you want to delete this role? This action cannot be undone."}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,s.jsx)("button",{onClick:()=>{k(null),p(!1)},className:"px-3 py-1 text-xs text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),(0,s.jsx)("button",{onClick:()=>{N&&handleDeleteRole(N)},className:"px-3 py-1 text-xs bg-red-500 text-white hover:bg-red-600 rounded-lg disabled:bg-red-300",disabled:f,children:f?"Deleting...":"Delete"})]})]})}),u&&(0,s.jsxs)("div",{className:"fixed bottom-5 right-5 p-3 rounded-lg shadow-lg text-sm flex items-center ".concat(h?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:[h?(0,s.jsx)(n.Z,{className:"w-5 h-5 mr-2"}):(0,s.jsx)(l.Z,{className:"w-5 h-5 mr-2"}),(0,s.jsx)("span",{children:u}),(0,s.jsx)("button",{className:"ml-3 text-sm hover:opacity-70",onClick:()=>x(null),children:"âœ•"})]})]})}}},function(e){e.O(0,[767,502,322,774,888,179],function(){return e(e.s=9842)}),_N_E=e.O()}]);