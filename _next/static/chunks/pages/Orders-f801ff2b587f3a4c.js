(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[741],{7650:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Orders",function(){return t(9421)}])},9421:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return Orders}});var a=t(5893),s=t(7294),n=t(9332),o=t(1503),d=t(4412),c=t(4346),i=t(3771),l=t(9035),u=t(1664),h=t.n(u);function Orders(){let{isAuthenticated:e,isLoading:r,token:t,logout:u}=(0,o.aC)(),x=(0,n.useRouter)(),[g,p]=(0,s.useState)(!1),[m,y]=(0,s.useState)(""),[j,k]=(0,s.useState)("All"),[b,f]=(0,s.useState)([]),[w,N]=(0,s.useState)(1),[v,A]=(0,s.useState)(8),[O,_]=(0,s.useState)(1),[C,E]=(0,s.useState)(null),[S,P]=(0,s.useState)(""),[T,D]=(0,s.useState)(null),[F,L]=(0,s.useState)(30),[z,R]=(0,s.useState)(!1);(0,s.useEffect)(()=>{r||e||x.push("/login"),t&&console.log("Orders page accessed, current token:",t)},[e,r,x,t]),(0,s.useEffect)(()=>{if(!e||!t){P("Please log in to view orders"),R(!1);return}let fetchOrders=async()=>{R(!0);try{let e=await (0,l.zk)(t,u);f(Array.isArray(e)?e:[]),_(Math.ceil((Array.isArray(e)?e.length:0)/v))}catch(e){P("Failed to fetch orders"),console.error("Failed to fetch orders",e)}finally{R(!1)}};fetchOrders()},[e,t,u,v]),(0,s.useEffect)(()=>{document.documentElement.classList.toggle("dark",g)},[g]);let handleAcceptOrder=async e=>{if(!t){P("Please log in to accept order");return}try{await (0,l.Nc)(t,u,e,F),f(b.map(r=>r._id===e?{...r,status:"preparing"}:r)),P("Order #".concat(e," accepted"))}catch(e){P("Failed to accept order"),console.error("Failed to accept order",e)}},handleRejectOrder=async e=>{if(!t){P("Please log in to reject order");return}if(window.confirm("Are you sure you want to reject this order?"))try{await (0,l.sl)(t,u,e),f(b.map(r=>r._id===e?{...r,status:"rejected"}:r)),P("Order #".concat(e," rejected"))}catch(e){P("Failed to reject order"),console.error("Failed to reject order",e)}},handleMarkAsReady=async e=>{if(!t){P("Please log in to mark order as ready");return}try{await (0,l.Dz)(t,u,e),f(b.map(r=>r.order_number===e?{...r,status:"on_delivery"}:r)),P("Order #".concat(e," marked as ready"))}catch(e){P("Failed to mark order as ready"),console.error("Failed to mark order as ready",e)}},handleMarkAsDelivered=async e=>{if(!t){P("Please log in to mark order as delivered");return}try{await (0,l.Cx)(t,u,e),f(b.map(r=>r.order_number===e?{...r,status:"delivered"}:r)),P("Order #".concat(e," marked as delivered"))}catch(e){P("Failed to mark order as delivered"),console.error("Failed to mark order as delivered",e)}},handleViewDetails=e=>{let r=b.find(r=>r._id===e);E(r||null)},M=s.useMemo(()=>Array.isArray(b)?null!==T?[...b].sort((e,r)=>e[T.key]<r[T.key]?"asc"===T.direction?-1:1:e[T.key]>r[T.key]?"asc"===T.direction?1:-1:0):[...b].sort((e,r)=>new Date(r.createdAt).getTime()-new Date(e.createdAt).getTime()):[],[b,T]),B=M.filter(e=>{var r;return("All"===j||e.status===j)&&((null===(r=e.customerName)||void 0===r?void 0:r.toLowerCase().includes(m.toLowerCase()))||e._id.toLowerCase().includes(m.toLowerCase())||e.order_number.toString().includes(m.toLowerCase()))}),I=B.slice((w-1)*v,w*v),handleSort=e=>{D(r=>({key:e,direction:(null==r?void 0:r.key)===e&&"asc"===r.direction?"desc":"asc"}))},renderActions=e=>{switch(e.status){case"pending":case"new":return(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>handleAcceptOrder(e._id),className:"text-green-600 hover:text-green-800 text-sm",children:"Accept"}),(0,a.jsx)("button",{onClick:()=>handleRejectOrder(e._id),className:"text-red-600 hover:text-red-800 text-sm",children:"Reject"})]});case"preparing":return(0,a.jsx)("button",{onClick:()=>handleMarkAsReady(e.order_number),className:"text-blue-600 hover:text-blue-800 text-sm",children:"Mark as Ready"});case"on_delivery":return(0,a.jsx)("button",{onClick:()=>handleMarkAsDelivered(e.order_number),className:"text-purple-600 hover:text-purple-800 text-sm",children:"Mark as Delivered"});default:return null}};return r||z?(0,a.jsx)("div",{className:"flex justify-center items-center h-screen",children:"Loading..."}):e?(0,a.jsx)("div",{className:"min-h-screen bg-gray-100 p-6 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Orders"}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)(h(),{href:"/CreateOrder",children:(0,a.jsx)("button",{className:"bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600",children:"Create New Order"})}),(0,a.jsx)(d.Z,{className:"w-6 h-6 text-gray-500 dark:text-gray-300"}),(0,a.jsx)("button",{onClick:()=>p(!g),children:g?(0,a.jsx)(c.Z,{className:"w-6 h-6 text-yellow-500"}):(0,a.jsx)(i.Z,{className:"w-6 h-6 text-gray-500 dark:text-gray-300"})}),(0,a.jsx)("button",{onClick:u,className:"bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600",children:"Logout"})]})]}),(0,a.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row sm:space-x-4 space-y-4 sm:space-y-0",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search orders...",value:m,onChange:e=>y(e.target.value),className:"p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white"}),(0,a.jsxs)("select",{value:j,onChange:e=>k(e.target.value),className:"p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white",children:[(0,a.jsx)("option",{value:"All",children:"All"}),(0,a.jsx)("option",{value:"pending",children:"Pending"}),(0,a.jsx)("option",{value:"new",children:"New"}),(0,a.jsx)("option",{value:"preparing",children:"Preparing"}),(0,a.jsx)("option",{value:"on_delivery",children:"On Delivery"}),(0,a.jsx)("option",{value:"delivered",children:"Delivered"}),(0,a.jsx)("option",{value:"rejected",children:"Rejected"})]}),(0,a.jsx)("input",{type:"number",value:F,onChange:e=>L(Number(e.target.value)),placeholder:"Prep Time (min)",className:"p-2 border border-gray-300 dark:border-gray-600 rounded-lg w-full sm:w-32 bg-white dark:bg-gray-800 text-gray-800 dark:text-white"})]}),S&&(0,a.jsx)("div",{className:"p-4 mb-4 rounded-lg ".concat(S.includes("Failed")?"bg-red-100 text-red-700 dark:bg-red-700 dark:text-red-200":"bg-green-100 text-green-700 dark:bg-green-700 dark:text-green-200"),children:S}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[(0,a.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300",children:[(0,a.jsxs)("th",{className:"py-3 px-4 cursor-pointer",onClick:()=>handleSort("_id"),children:["Order ID ",(null==T?void 0:T.key)==="_id"&&("asc"===T.direction?"↑":"↓")]}),(0,a.jsxs)("th",{className:"py-3 px-4 cursor-pointer",onClick:()=>handleSort("order_number"),children:["Order Number ",(null==T?void 0:T.key)==="order_number"&&("asc"===T.direction?"↑":"↓")]}),(0,a.jsxs)("th",{className:"py-3 px-4 cursor-pointer",onClick:()=>handleSort("createdAt"),children:["Date ",(null==T?void 0:T.key)==="createdAt"&&("asc"===T.direction?"↑":"↓")]}),(0,a.jsxs)("th",{className:"py-3 px-4 cursor-pointer",onClick:()=>handleSort("customerName"),children:["Customer Name ",(null==T?void 0:T.key)==="customerName"&&("asc"===T.direction?"↑":"↓")]}),(0,a.jsx)("th",{className:"py-3 px-4",children:"Location"}),(0,a.jsxs)("th",{className:"py-3 px-4 cursor-pointer",onClick:()=>handleSort("total_amount"),children:["Amount ",(null==T?void 0:T.key)==="total_amount"&&("asc"===T.direction?"↑":"↓")]}),(0,a.jsxs)("th",{className:"py-3 px-4 cursor-pointer",onClick:()=>handleSort("status"),children:["Status ",(null==T?void 0:T.key)==="status"&&("asc"===T.direction?"↑":"↓")]}),(0,a.jsx)("th",{className:"py-3 px-4",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:I.map(e=>(0,a.jsxs)("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsx)("button",{className:"text-indigo-600 hover:underline",onClick:()=>handleViewDetails(e._id),children:e._id})}),(0,a.jsx)("td",{className:"py-3 px-4",children:e.order_number}),(0,a.jsx)("td",{className:"py-3 px-4",children:new Date(e.createdAt).toLocaleString()}),(0,a.jsx)("td",{className:"py-3 px-4",children:e.customerName||"N/A"}),(0,a.jsx)("td",{className:"py-3 px-4",children:e.location||"N/A"}),(0,a.jsxs)("td",{className:"py-3 px-4",children:["$",e.total_amount||e.amount||"N/A"]}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("pending"===e.status||"new"===e.status?"bg-yellow-100 text-yellow-800 dark:bg-yellow-700 dark:text-yellow-200":"preparing"===e.status?"bg-blue-100 text-blue-800 dark:bg-blue-700 dark:text-blue-200":"on_delivery"===e.status?"bg-pink-100 text-pink-800 dark:bg-pink-700 dark:text-pink-200":"delivered"===e.status?"bg-green-100 text-green-800 dark:bg-green-700 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-700 dark:text-red-200"),children:e.status})}),(0,a.jsx)("td",{className:"py-3 px-4",children:renderActions(e)})]},e._id))})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center p-4",children:[(0,a.jsxs)("select",{value:v,onChange:e=>A(Number(e.target.value)),className:"p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white",children:[(0,a.jsx)("option",{value:8,children:"8 per page"}),(0,a.jsx)("option",{value:16,children:"16 per page"}),(0,a.jsx)("option",{value:24,children:"24 per page"})]}),(0,a.jsx)("div",{className:"flex space-x-2",children:Array.from({length:O},(e,r)=>(0,a.jsx)("button",{onClick:()=>N(r+1),className:"px-3 py-1 rounded-lg ".concat(w===r+1?"bg-indigo-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white"),children:r+1},r+1))}),(0,a.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Page ",w," of ",O]})]})]}),C&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold mb-4 text-gray-800 dark:text-white",children:["Order #",C._id]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Order Number:"})," ",C.order_number]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Customer:"})," ",C.customerName||"N/A"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Date:"})," ",new Date(C.createdAt).toLocaleString()]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Location:"})," ",C.location||"N/A"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Amount:"})," $",C.total_amount||C.amount||"N/A"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Status:"})," ",C.status]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Order Type:"})," ",C.order_type]}),(0,a.jsx)("p",{className:"mt-4",children:(0,a.jsx)("strong",{children:"Items:"})}),(0,a.jsx)("ul",{className:"list-disc pl-5",children:C.items.map((e,r)=>(0,a.jsxs)("li",{children:[e.product_id," (x",e.quantity,")"]},r))}),(0,a.jsx)("div",{className:"mt-6 flex justify-end space-x-2",children:(0,a.jsx)("button",{onClick:()=>E(null),className:"bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400",children:"Close"})})]})})]})}):null}},9035:function(e,r,t){"use strict";t.d(r,{Cx:function(){return markOrderAsPicked},Dz:function(){return markOrderAsReady},LV:function(){return createOrder},Nc:function(){return confirmOrder},sl:function(){return cancelOrder},zk:function(){return getAllOrders}});var a=t(6501),s=t(3454);let handleApiError=(e,r)=>{if(!e.success)switch(console.error("API Error:",e),e.statusCode){case 400:return e.message||"Invalid input provided";case 401:return r(),window.location.href="/pos-system/login","Please log in to continue";case 403:return"Access denied";case 404:return e.message||"Resource not found";case 409:return e.message||"Duplicate entry";case 500:return"An unexpected server error occurred";default:return"An unexpected error occurred"}return""},n=s.env.NEXT_PUBLIC_API_URL||"http://192.168.18.107:3000",getAllOrders=async(e,r)=>{try{let t=await fetch("".concat(n,"/orders/api/v1/list"),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let a=await t.json();if(!a.success)throw Error(handleApiError(a,r));return"data"in a.data?a.data.data:a.data||[]}catch(e){throw console.error("Error in getAllOrders:",e),Error(e instanceof Error?e.message:"Failed to fetch orders")}},createOrder=async(e,r,t,s)=>{try{let a=await fetch("".concat(n,"/orders/api/v1/create"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({items:t,...s})});if(401===a.status)throw r(),window.location.href="/pos-system/login",Error("Unauthorized");let o=await a.json();if(!a.ok||!o.success)throw Error(handleApiError(o,r));if("data"in o.data)return o.data.data;return o.data}catch(r){let e=r instanceof Error?r.message:"Failed to create order";throw a.ZP.error(e),r}},confirmOrder=async(e,r,t,a)=>{try{let s=await fetch("".concat(n,"/orders/api/v1/confirm"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({order_id:t,preparation_time:a})}),o=await s.json();if(!s.ok||!o.success)throw Error(handleApiError(o,r))}catch(e){throw Error(e instanceof Error?e.message:"Failed to confirm order")}},markOrderAsReady=async(e,r,t)=>{try{let a=await fetch("".concat(n,"/orders/api/v1/ready"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({order_number:t})}),s=await a.json();if(!a.ok||!s.success)throw Error(handleApiError(s,r))}catch(e){throw Error(e instanceof Error?e.message:"Failed to mark order as ready")}},markOrderAsPicked=async(e,r,t)=>{try{let a=await fetch("".concat(n,"/orders/api/v1/picked"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({order_number:t})}),s=await a.json();if(!a.ok||!s.success)throw Error(handleApiError(s,r))}catch(e){throw Error(e instanceof Error?e.message:"Failed to mark order as picked")}},cancelOrder=async(e,r,t)=>{try{let a=await fetch("".concat(n,"/orders/api/v1/cancel"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({order_id:t})}),s=await a.json();if(!a.ok||!s.success)throw Error(handleApiError(s,r))}catch(e){throw Error(e instanceof Error?e.message:"Failed to cancel order")}}}},function(e){e.O(0,[609,774,888,179],function(){return e(e.s=7650)}),_N_E=e.O()}]);